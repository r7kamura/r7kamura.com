---
title: リリースノート管理術
---
みなさま、OSSの変更履歴、要するにCHANGELOGやリリースノートはどのように管理しておられるでしょうか。自分はというと、抱えるリポジトリも数百個に増えてきて、まあ要するに細かく管理するのがだるく、最近は変更履歴の管理方法も変わってきました。

CHANGELOGからGitHub Releasesへ
---------------------------

昔は、おおよそ[Keep a changelog](https://keepachangelog.com/en/1.0.0/)の方式に準拠したCHANGELOG.mdを書いていました。semantic versioningでバージョン管理をしながら、個々のバージョンごとに次のセクションを設けて変更内容を説明するような感じです。

*   Added
*   Changed
*   Deprecated
*   Fixed
*   Removed
*   Security

今は、新規につくるリポジトリではCHANGELOG.mdは用意せず、GitHub ReleasesにKeep a changelogに似た形式で変更内容を記載することにしています。昔はGitHub Releasesの出来もあまり良くなく、認知度も低かったので、GitHub Releasesで変更履歴が管理されている他所様のライブラリを見るたびに「CHANGELOG.mdを用意してほしいぜ……」と思っていたこともありました。しかし最近では意識も変わり、またGitHub Releasesも使いやすくなってきたので、これで良いかと思うようになりました。

CHANGELOG.mdにまとまっている方が分かりやすいという気持ちも確かにあるのですが、Contributorの方も含めてルールを統制してもらおうと思うとなかなか難しかったり、CHANGELOGを自動生成するにしても諸説あって楽ではなかったり、また素朴にやるとコンフリクトが発生しやすかったりと、なかなか大変です。この微妙な煩わしさのせいで開発やメンテが停滞すると元も子もないので、GitHub Releasesで自動生成するぐらいがコスト的に丁度いいかなというのが、今の自分の落とし所です。

リリースノート自動生成
-----------

[GitHubはリリースノートを自動生成する機能を備えています](https://docs.github.com/en//repositories/releasing-projects-on-github/automatically-generated-release-notes)。そのバージョンでMergeされたPull Request達をまとめてくれる機能です。各Pull RequestへのリンクやそのAuthorの名前、またそのバージョンでのContributors一覧なんかも含まれるので、なかなか便利です。これを自分で生成しようとしたらそこそこ大変。自分の名前の箇所は、GitHubの機能でハイライトされてますね。

![](https://lh3.googleusercontent.com/docs/ADP-6oHecWtqxgwyvFilUOnt3kd7rGOA_tNeMEYgkgG8ux2iYQ9Dk9zZwxgknityROvioGv17rKmz5_W7PAoGLxlZmwHWJx9gmYgPAubaCydTbIc9FIS4BRKIZBS3FZDMjMiCa9I2Chiiw6YWg9va-8x-tZgCkKp-um-UlYJbXSt1qpxGS__qmFC6dMv1qd7XnNXDdcMU-ppjP7Rf5YpXORewcvTdx3Hck-u4i2aQK_Q9ev8qmnLhr2VYJ_NLpAS8R31eXpgPwd4nIaJQY935jcWVhuOaVWmghM8ML-rrB-mYN3UNgCcVdw0b18LrVx6kVIjZrqiXdIj3HfNxkE4kxPTIeUlLTbvYs1HOq7nfl1oAMKtAeK4RLB_jQXxsb6_qAl0oPbew4V532kxw8EyXboi5tJrUBkCtIpoKCkMUO5nGeABgXuwqRXU1bbr2owKP-OgqCcj79ycEqIkEd-luCKvM7IWIJUqKQT9lcNJU8BW5fr_puHUCKgbI39qEXB5hRvPU49ruERpIBTJFLm3rLZ0xcnL56x99RZPZULG8BPqO4qQxFhpz4ST07s6ViGaDALXkD-fLblY98kyg5ARjZuSDmvzYmeCv_injm0Y4vVaZ9XRUF_eBiIyizwDgjhrnMK_JrO5FLfPM2I2Ni34XCV0VTfw13Da512nXtQWjfe6QdUTLYOipYFMOXVG2DWRC1JPVkm2nd75hI-VorAm9YJz1iezWx44KaIDenWAlWqwIy4GpJ-j9gvbTlerUIJpzt3PzG3-6kpOBju8xoDGFl53TBKJ8pV07tOGmGJWi6Y4iRT1BNxN9Omm8640Lzggs_UEUkmy9VVoUvSxN03I6BGnh2ha27nnR-a5qNPo_y2zhM-agvANYXP0HyFlPl29QW_kxrsMOHXQZDyTgEaqslB7deFn65ylB4uQpbv5GyQctJ_kFOmbiXX5TXVNFE_8EIs7QSdEvSHN5P88cAPaa7RJXhNmX_SO-TG69D62lfRaxCBpRTsG2GPXknHDorIzVA323XpXJCrrvNsNfOxhWmvdoBn0UWzeskQlyaLPlyv0qECK34yTxuvxnz9gXJtF3wFw3WpniZpSN9BdJcup0mnmHK2FLQbR_TbTUimGjM3QLUwhysBdL7U0nOaOlmxIbR5Ij2fbSuml588UGLtChFfyVKaCUHRpzwr8Lxef2DxQBiAjEZMjOkoBvCGJJdzkxRQsc6cBJbtLtAwVZk6j1ziLVBFvBYMIcdTBpcc2UKgrJL70uNyh-w "自動生成されたリリースノートの一例")

.github/release.ymlという定義ファイルを用意しておけば、Pull Requestに付いているラベルごとにセクションを分けてくれる機能も付いています。自分はKeep a changelogライクな方式で記載したいため、add・change・removeなど6種類のラベルを用意し、これを個々のPull Requestに付与しています。基本的にはレビュー時に付けますが、忘れていてもリリース前に付けておけばOKで、またリリース後でも後から再生成したり手作業で編集したりもできます。

Othersというその他枠のセクションも用意しているので、ライブラリの利用者に影響があるPull Requestは6種類のセクションにまとまり、その他の変更、例えば開発環境の仕組みが変わったとか、CIを別のサービスに変更したといったものなんかがOthersのセクションにまとめられて、これも意外と便利なところです。

ちなみにですが、この「リリースノート用のMarkdownの文字列を生成する」という機能はGitHub APIからも使えて、しかも利用する定義ファイルも好きに選択できます。これは強力な機能で、例えば業務でのアプリのリリースなんかでも、適切にラベルを運用していれば、内部の開発者用リリースノートを用意したり、QA担当者用リリースノートを用意したり、といった用途で活用できます。

これらの仕組みの存在により、「Pull Requestのタイトルやラベルを適切に付与しよう」という意識が強まるのも良いことだと思います。conventional commitを用いて自動生成するような方式だと、メンテナ側が変更内容に手を加えるのが容易ではないですが、Pull Requestのタイトルやラベルは後から簡単に改善できます。この改善はPull Requestの検索時など他の用途に対しても有利に働くので、いい仕組みだと思います。

ラベル自動管理
-------

リポジトリごとにKeep a changelog相当のラベルを用意するのが面倒なので、[github-label-sync-action](https://github.com/r7kamura/github-label-sync-action)というGitHub Actionでラベルの用意を自動化しています。各ラベルの名前・説明文・色をlabels.ymlに記載しておくと、自動的にそのリポジトリのラベルを同期してくれるというものです。

このGitHub Actionでは外部のリポジトリに配置しているlabels.ymlも指定できるので、[github-label-presets](https://github.com/r7kamura/github-label-presets)というリポジトリにお決まりのパターン集をつくり、基本的にはこれを参照して使うことにしています。リポジトリごとに変更したくなってきたら、そのタイミングで独自のlabels.ymlを運用し始めるような感じ。

![](https://lh3.googleusercontent.com/docs/ADP-6oG2o1ASdMb0cr-ifoUfx0miZitZimVn3OljulvpecgqhR9iWtyFJMoumUaY2wxkl23kt1ZfQ4J_37RYleunx28RK3OBDgbHDb0Jra-iy2Lu1xZGPVCd95HmuuGIaw0l1NrN_iJUWzfwFLV_Bj9UdTFOwlPuRMf4ozOf6RefvWsIupI-YAe22J7uKPyMafEZabfqOK_3khf3Ov9-QNLkvXocRlefy-ryGI_g7u0dycbcTpcBFDE7OCYbpeUd5tvOFDkHqmYGDSz4Ty54yif7isncBk1QhfrUJZLkW9eOaQv0ibDBoWN55UxpqbmdKEzXlUYBSVeGtrn3wT1VnOc0xYtPfV2_p0yGopmwSoXOoKxLDPTRcTVNBpO1VBLgf0BcQv_MYgi6VYh8MMnkShsoakFKWXMWKV1prseCpbb2K6aW5AfEfKmjpj1n-XjetvFu8CIz4Awq5eYgbrV7zhiCOfDigeBEXrsMzi3QR6PKKkqKEewcY_Iv8pwhUE_tSAHhGkchLfabR9CpJhh_DpTf6iQU2A8LvVKczl2z3HzI4umoc0Gz0rxwaBUHqTWmzhxQExQ8HUDaVo26aUvomUHm9jXK2IslrVFr1jtoYaK_hx6WW1gqwLJSE0U51jAkLeg8rdoZpNwPujORo47Z-UxymqbZe2C10ormu0I-PlaXX2eIeH9VAbsX8EX_FUuRsWdBOaaqChne9-6SIn1HmZd72rSn6BcMREXK1x3TUJysBrNtQ_Z06thoRPdb8Frrsu3ypLAFgBod4_MnZVs6ukA3WgljZIE3c2v8Y9tZmLjLVFhUB5OODvAs2FmTEbm1xszCfKdhi0NYfnyqmjZuEwqI7sgvzqgwdM-b4DvNMxf5clrcfRXtYwl_PwWPxXGv9CsphZUEPYTYIYMZQYWH77CZaSLQ-NrcyjuklJbx4SH0GPSAh1McFCDuAaQk6k3LLzBGjtEFUQzg8Hor29khTXXV5Gnqx6AgWwGoStGI22RYtwVPSGxDfBu0zK-xxG31ee6tVX25wUfOsR15v6hlnn_ohwSmP9Uol6UW3p_5iHRro1tNFLq4J93Plosd2EiSdi2PFEk_gci3oWXWXFNhsKEoK79-bDC4T1nZvQXXp52COskMAt-anNnSbIyzVdJ5asFiTtxQf6F-GZTtRx6lpdceb_NPd1MRuWhNfxSaTczITutIvppk-RN6Y0bPdUpsrsDgqStHB53nf6kAxNe5qMYnLbj3Bs11JAG0AadFvEO7L5ykXzqMVg "自動的に用意されたラベルの例")

自動リリース
------

タグやリリースのような新規バージョンの発行作業も、最近はGitHub Actionsを使って自動的に行うようにしています。例えばChrome拡張であれば、manifest.jsonにバージョンを記載しますよね。その変更を検知して、自動的にGitのタグを発行し、リリースを発行し、というWorkflowを組んでいます。

リポジトリごとにそういったWorkflowを用意するのは面倒なので、[Reusable workflows](https://docs.github.com/en//actions/using-workflows/reusing-workflows)という仕組みを使い、自分用のWorkflowを[r7kamura/workflows](https://github.com/r7kamura/workflows)にまとめています。例えばNPMパッケージであればpackage.jsonのversionプロパティを解析すれば良いとか、CHANGELOG.mdでバージョンを管理しているプロジェクトは先頭のほうの見出しを解析すれば良いとか、またGitHub Actionをリリースするときはv1ブランチのようなメインバージョン用のRefを最新版に保つ必要があるとか、プロジェクトの性格に応じた再利用可能なWorkflowを用意しています。

新規バージョンの自動的な発行は、ただ手間やミスが減るということもそうですが、透明性やコミュニケーションコストの意味でも効果があると思います。新機能を入れたバージョンが早くリリースされてほしいんだけど、ただ忘れているだけであれば要求をしたいが、誰が権限持っててどういうフローで承認取れば良いのか分からん……みたいなことがよくあり、その辺がコードで管理されていると、Pull Requestでバージョン変更を要求できたりして楽できます。あとはまあ単純に、久しぶりすぎてリリース方法を思い出せないとか、開発環境を変えたのでその言語のリリースに必要な実行環境が手元に用意できていないとか、そういう問題も解消できて嬉しい。

まとめ
---

リリースノートの管理方法について、次のような話をしました。

*   最近はGitHub Releasesを使っている
*   ラベル管理に[github-label-sync-action](https://github.com/r7kamura/github-label-sync-action)を使っている
*   タグやリリースの発行もGitHub Actionsで自動化している

mizdraさんの[リリースノート自動生成テクニック](https://www.mizdra.net/entry/2022/07/08/181825)に触発されて、この機会に自分の管理方法を改めてまとめてみることにしました。他の方の管理方法やポリシーもぜひ読んでみたいです。
