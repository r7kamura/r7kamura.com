---
title: ドメインをRoute53からCloudflareに移管
---

r7kamura.comドメインをAmazon Route53からCloudflareに移管したので、手順等を書き残しておきます。

## Cloudflareのアカウント作成

自分の場合、2016年にアカウントを作成していたので、このアカウントを利用しました。無い場合はここで作成することになります。

- <https://www.cloudflare.com/ja-jp/>

ドメインの移管や維持にはお金が掛かります。ドメイン移管時に支払い情報の登録が必要になるので、ここで予めクレジットカードの情報等を設定しておくと事が円滑に進みます。

## Cloudflareにドメイン名を登録

Cloudflareにログインし、管理画面右上の "Add a site" から、ドメイン名を登録してサイト情報を用意します。

ドメイン名を入力すると、このサイトに対して利用する料金プランを選択することになります。自分の場合、今回は無料のもので十分なので、Freeプランを選択しました。ここで、このドメインに今から設定すべきネームサーバーのアドレスが表示されます。今回は2つ表示されました。

## CloudflareのSSL設定を調整

今回移管するドメインは、GitHub Pagesでホスティングしてもらっている本ウェブサイトのために利用します。注意点として、GitHub PagesやVercel等でCloudflareを利用する場合、Cloudflare側で追加で必要な設定があります。Cloudflareにサイト (ドメイン) を登録した際、デフォルトではSSL/TLS encryption modeの設定が "Flexible" になります。GitHub PagesやVercelでは "Flexible" を利用するとリダイレクトループが発生してしまうため、今回はこれを "Full" または "Full (strict)" に変更する必要があります。

詳しい情報については、[dns - How to fix ERR_TOO_MANY_REDIRECTS on custom github pages domain? - Stack Overflow](https://stackoverflow.com/questions/50145231/how-to-fix-err-too-many-redirects-on-custom-github-pages-domain) 等が参考になります。

## Route53側のネームサーバーを変更

Route53の登録済みドメインの設定画面に行き、移管対象のドメインのネームサーバーを、前述のCloudflare側で発行されたものに変更します。

この設定により、このドメインにアクセスした際、Cloudflareのネームサーバーにアクセスされるようになります。Cloudflare側では、ドメイン登録時にRoute53から読み取ったDNSレコードが勝手に設定されているので、今回の用途のようなドメインであれば何も設定しなくてもこれまで通り上手く接続できるはずです。

## Cloudflare側でネームサーバーをチェック

Route53側でネームサーバーの設定が完了したら、設定が完了したことを伝えるボタンをCloudflare側で押します。日本語UIだと「ネームサーバーをチェック」みたいなやつですね。ネームサーバーの反映にはしばらく掛かるので、これはその時点で成功しなくても問題ありません。

## Route53側でドメイン移管リクエストを送信

前準備として、Route53の登録済みドメインの設定画面に行き、もし対象ドメインの移管ロックがオンになっていたら、オフにします。自分の場合、元々オフでした。

Route53に、別のレジストラにドメインを移管するリクエストを送ります。ここで、移管先のCloudflareで発行される認証コードの入力を求められます。Cloudflare側でこの認証コードを取得できるので、これを持ってきて入力します。連絡先情報等の入力も求められます。

## 移管の承認確認に対応

Route53側でドメイン移管リクエストを送信したら、ドメインの移管がはじまり、しばらく後に承認用のメールが届きます。このメールには、ドメイン移管の承認確認のためのURLが記載されているので、これを開いて承認作業を行います。これで、移管作業が完了します。

## ホストゾーンの削除

最後に、Route53にホストゾーンが存在していると課金され続けてしまうので、元々利用していたホストゾーンを削除しておきます。

## 料金面

r7kamura.comドメインの運用に必要な金額を整理してみます。

Route53の場合、この1年間では20.44USD (≒2,912円) 課金されていました。課金される要素は以下の通り。

- ドメインの更新
- DNSクエリ
- ホストゾーン

ドメインの更新は、.comドメインの場合は年間13USD課金されます。

DNSクエリに対しての課金は、以下の価格設定に対して月平均300,000クエリが発生していたので、月額0.12USD課金されます。

> $0.40 per 1,000,000 queries for the first 1 Billion queries

ホストゾーンに対しての課金は、以下の価格設定に対して、ドメインを1個管理するためにホストゾーンを1個設定する必要があるため、月額0.50USD課金されます。

> $0.50 per Hosted Zone for the first 25 Hosted Zones

Cloudflareの場合、年間8.03USD (≒1,142円) 課金される見込みです。課金される要素は以下の通り。

- ドメインの更新

ドメインの更新は、.comドメインの場合は年間8.03USDです。
