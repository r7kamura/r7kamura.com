---
title: markus
---

軽い気持ちでMarkdownパーサーを書き始めた。

- <https://github.com/r7kamura/markus>

Rustの代表的なMarkdownパーサーである[pulldown-cmark](https://github.com/raphlinus/pulldown-cmark)を主に参考にしながら書いていっている。数時間ほど作業して、とりあえずParagraphとATX Headingがパースでき、HTMLに変換できる程度の情報を吐き出せるようになった。

## ATX Heading

ATX Headingというのは、`## foo` みたいな形式の見出し記法。この種類の見出しだけでも、実装すべき仕様が沢山ある。

- <https://spec.commonmark.org/0.30/#atx-headings>

次のように、enclosing sequenceというものを末尾に置くことができる。連続する空白とタブ、連続する `#`、連続する空白とタブというパターンの文字列だ。

```markdown
## foo #
```

次のように、行頭に3つまでの空白を置くこともできる。4つになるとコードブロックとして扱われてしまうので、3つまで。

```markdown
 ### foo
  ## foo
   # foo
```

次のように、テキストノード無しの見出しも書ける。通常は、連続する `#` の直後に空白を1つ以上置く必要があるが、テキストノードが無い場合に限っては空白を置かなくても良い。3行目の例は、前述したenclosing sequenceを併用している。

```markdown
##
#
### ###
```

文字列の終端にきちんと改行があることを前提としていないので、実装中は、改行または文字列終端まで読む、というパターンがよく出てきて少し大変だったりする。
